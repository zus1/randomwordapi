@header-admin;
@include.(navigationCms)
<div class="container">
    <div class="roe content-wrapper">
        <div class="col-md-12 col-lg-12 col-sm-12">
            <div class="content-title">Edit page content</div>
            <div class="form-group">
                <div style="height: 50px;">
                    <div id="alert-edit" class="notification" style="display: none">
                        <div id="notification-edit"></div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <select class="form-control" id="edit-page">
                    <option value="" selected disabled>Select page to edit</option>
                    @foreach.(pages)
                        <option value="@value.(name)">@value.(name)</option>
                    @endforeach
                </select>
            </div>
            <div class="form-group">
                <select class="form-control" id="edit-local">
                    <option value="" disabled selected>Select local</option>
                    @foreach.(locals)
                        <option value="@value.(tag)">@value.(tag)</option>
                    @endforeach
                </select>
            </div>
            <div class="form-group">
                <select class="form-control" id="edit-holder">
                    <option value="" disabled selected>Select placeholder</option>
                </select>
            </div>
            <div class="form-group">
                <textarea class="form-control" id="edit-content" cols="20" rows="10" placeholder="Edit placeholder content"></textarea>
            </div>
            <div class="form-group content-footer">
                <button type="button" class="login-button" id="edit-button">Edit</button>
            </div>
        </div>
    </div>
</div>
<script src="{base_url}js/ajax.js"></script>
<script src="{base_url}js/utilities.js"></script>
<script>
    const editPage = document.getElementById("edit-page");
    const editLocal = document.getElementById("edit-local");
    const editHolder = document.getElementById("edit-holder");
    const editContent = document.getElementById("edit-content");
    const editButton = document.getElementById("edit-button");

    editPage.addEventListener("change", () => loadPlaceholders(event));
    editPage.addEventListener("change", () => resetContent());
    editHolder.addEventListener("change", () => loadContent(event));
    editButton.addEventListener("click", () => contentEdit());

    function contentEdit() {
        if(editPage.value === "") {
            addNotification("error", "Please select page to edit", "edit");
        } else if(editLocal.value === "") {
            addNotification("error", "Please select local", "edit");
        } else if(editHolder.value === "") {
            addNotification("error", "Please select placeholder", "edit");
        } else {
            const formData = new FormData();
            formData.append("page-name", editPage.value);
            formData.append("local", editLocal.value);
            formData.append("placeholder", editHolder.value);
            formData.append("content", editContent.value);

            postAjax("/views/cms/editpagecontent.php", formData, postContentEdit)
        }
    }

    function postContentEdit(data) {
        let key;
        if(data.error === 1) {
            key = "error";
        } else {
            key = "success"
        }
        addNotification(key, data.message, "edit");
    }

    $(document).ready(function () {
        $("#edit-content").cleditor({
            controls: // controls to add to the toolbar
                "bold italic underline strikethrough subscript superscript | font size " +
                "style | color highlight removeformat | bullets numbering | outdent " +
                "indent | alignleft center alignright justify | undo redo | " +
                " cut copy paste pastetext",
        });
    });

    function loadContent(event) {
        if(event.target.value === "") {
            addNotification("error", "Please select placeholder for content to load", "edit");
        } else if(editLocal.value === "") {
            addNotification("error", "Please select local for content to load", "edit");
        } else if(editPage.value === "") {
            addNotification("error", "Please select page for content to load", "edit");
        } else {
            getAjax("/views/cms/getplaceholdercontent.php?page-name=" + editPage.value + "&local=" + editLocal.value + "&placeholder=" + editHolder.value, postLoadContent);
        }
    }

    function postLoadContent(data) {
        if(parseInt(data.error) === 1) {
            console.error(data.message);
        } else {
            editContent.value = data.content;
            $("#edit-content").cleditor()[0].updateFrame();
        }
    }

    function resetContent() {
        $("#edit-content").cleditor()[0].clear();
    }

    function loadPlaceholders(event) {
        if(event.target.value === "") {
            addNotification("error", "Please select page", "edit");
        } else {
            getAjax("/views/cms/getcontentplaceholders.php?page-name=" + event.target.value, postLoadPlaceholders);
        }
    }

    function postLoadPlaceholders(data) {
        if(data.error === 1) {
            console.error(data.message);
        } else {
            resetOptionsAndPreserveFirstChild(editHolder, true)
            data.placeholders.forEach((element) => {
                createOptionElement(element, element, editHolder);
            });
        }
    }
</script>
@footer-admin;